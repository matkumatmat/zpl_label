import pandas as pd
import requests
import shutil
from reportlab.lib.pagesizes import letter
from reportlab.pdfgen import canvas
import os
import socket

# Read CSV file
data = pd.read_csv(r'C:\Users\rahmat.wahyu\Desktop\project excel\hasil_packing.csv')

# Loop through each row in the DataFrame
for index, row in data.iterrows():
    # Extract necessary fields
    tgl_kirim = row['TANGGAL']
    nama_alamat = row['db_ALAMAT.NAMA']
    jalan_alamat = row['db_ALAMAT.JALAN']
    provinsi_alamat = row['db_ALAMAT.PROVINSI']
    pic_alamat = row['db_ALAMAT.PIC']
    notel_alamat = row['db_ALAMAT.NO-TEL']
    produk = row['PRODUK']
    no_box = row['NO_BOX']
    total_box = row['TOTAL_BOX']

zpl_code = f""""
^XA

^FO30,1320^GFA,23400,23400,75,,::::::::::::::::::::::::::::::::::::P0iFO03hYFC,P0iF8N03hYFC,P0iFO03hYFC,:P0iF8N03hYFC,:::::P0FFEhT03FF8N03FFhU0FFC,P0FFChT03FF8N03FFhU0FFC,:::::::::::::::::::::::::::::::::P0FFChT03FF8N03FFW01Y08W0FFC,P0FFChT03FF8N03FFW038W01CW0FFC,P0FFChT03FF8N03FFW078W01EW0FFC,P0FFChT03FF8N03FFW07CW03EW0FFC,P0FFChT03FF8N03FFW0FEW03FW0FFC,P0FFChT03FF8N03FFW0FEW07FW0FFC,P0FFChT03FF8N03FFV01FFW0FF8V0FFC,P0FFChT03FF8N03FFV03FFW0FFCV0FFC,P0FFChT03FF8N03FFV03FF8U01FFCV0FFC,P0FFChT03FF8N03FFV07FFCU03FFEV0FFC,P0FFChT03FF8N03FFV07FFCU03IFV0FFC,P0FFChT03FF8N03FFV0IFEU07IFV0FFC,P0FFChT03FF8N03FFU01JFU07IF8U0FFC,P0FFChT03FF8N03FFU01JFU0JF8U0FFC,P0FFChT03FF8N03FFU03JF8S01JFCU0FFC,P0FFChT03FF8N03FFU03JF8S01JFEU0FFC,P0FFChT03FF8N03FFU07JFCS03JFEU0FFC,P0FFCN07gVFEN03FF8N03FFU0KFES03KFU0FFC,P0FFCN07gWFN03FF8N03FFU0KFES07KF8T0FFC,P0FFCN07gWFN03FF8N03FFT01LFS0LF8T0FFC,P0FFCN07gWFN03FF8N03FFT03LFS0LFCT0FFC,P0FFCN07gWFN03FF8N03FFT03LF8Q01LFCT0FFC,P0FFCN07gWFN03FF8N03FFT07LFCQ03LFET0FFC,P0FFCN07gWFN03FF8N03FFT0MFCQ03MFT0FFC,P0FFCN07gWFN03FF8N03FFT0MFEQ07MFT0FFC,P0FFCN07gVFEN03FF8N03FFS01NFQ07MF8S0FFC,P0FFCN03gVFEN03FF8N03FFS01NFQ0NF8S0FFC,P0FFCN03gVFEN03FF8N03FFS03NF8O01NFCS0FFC,P0FFCN03gVFEN03FF8N03FFS07NF8O01NFES0FFC,P0FFCN03gVFEN03FF8N03FFS07NFCO03NFES0FFC,P0FFCN03gVFCN03FF8N03FFS0OFEO03OFS0FFC,P0FFCN01gVFCN03FF8N03FFR01OFEO07OF8R0FFC,P0FFCN01gVFCN03FF8N03FFR01PFO0PF8R0FFC,P0FFCN01gVFCN03FF8N03FFR03PFO0PFCR0FFC,P0FFCN01gVF8N03FF8N03FFT07LFCQ03LFET0FFC,P0FFCO0gVF8N03FF8N03FFT03LFS0LFCT0FFC,:P0FFCO0gVFO03FF8N03FFT03LFS0LFCT0FFC,P0FFCO07gUFO03FF8N03FFT03LFS0LFCT0FFC,:P0FFCO07gTFEO03FF8N03FFT03LFS0LFCT0FFC,P0FFCO03gTFEO03FF8N03FFT03LFS0LFCT0FFC,P0FFCO03gTFCO03FF8N03FFT03LFS0LFCT0FFC,P0FFCO01gTFCO03FF8N03FFT03LFS0LFCT0FFC,:P0FFCP0gTF8O03FF8N03FFT03LFS0LFCT0FFC,P0FFCP0gTFP03FF8N03FFT03LFS0LFCT0FFC,P0FFCP07gSFP03FF8N03FFT03LFS0LFCT0FFC,:P0FFCP03gRFEP03FF8N03FFT03LFS0LFCT0FFC,P0FFCP03gRFCP03FF8N03FFT03LFS0LFCT0FFC,P0FFCP01gRFCP03FF8N03FFT03LFS0LFCT0FFC,P0FFCQ0gRF8P03FF8N03FFT03LFS0LFCT0FFC,P0FFCQ0gRFQ03FF8N03FFT03LFS0LFCT0FFC,P0FFCQ07gQFQ03FF8N03FFT03LFS0LFCT0FFC,P0FFCQ07gPFEQ03FF8N03FFT03LFS0LFCT0FFC,P0FFCQ03gPFCQ03FF8N03FFT03LFS0LFCT0FFC,P0FFCQ01gPFCQ03FF8N03FFT03LFS0LFCT0FFC,P0FFCR0gPF8Q03FF8N03FFT03LFS0LFCT0FFC,P0FFCR07gOFR03FF8N03FFT03LFS0LFCT0FFC,P0FFCR03gNFER03FF8N03FFT03LFS0LFCT0FFC,P0FFCR03gNFCR03FF8N03FFT03LFS0LFCT0FFC,P0FFCR01gNF8R03FF8N03FFT03LFS0LFCT0FFC,P0FFCS0gNFS03FF8N03FFT03LFS0LFCT0FFC,P0FFCS07gLFES03FF8N03FFT03LFS0LFCT0FFC,P0FFCS03gLFES03FF8N03FFT03LFS0LFCT0FFC,P0FFCS01gLF8S03FF8N03FFT03LFS0LFCT0FFC,P0FFCT0gLFT03FF8N03FFT03LFS0LFCT0FFC,P0FFCT03gJFET03FF8N03FFT03LFS0LFCT0FFC,P0FFCT01gJFCT03FF8N03FFT03LFS0LFCT0FFC,P0FFCU0gJF8T03FF8N03FFT03LFS0LFCT0FFC,P0FFCU07gHFEU03FF8N03FFT03LFS0LFCT0FFC,P0FFCU01gHFCU03FF8N03FFT03LFS0LFCT0FFC,P0FFCV0gHF8U03FF8N03FFT03LFS0LFCT0FFC,P0FFCV07gFEV03FF8N03FFT03LFS0LFCT0FFC,P0FFCV01gFCV03FF8N03FFT03LFS0LFCT0FFC,P0FFCW07YFW03FF8N03FFT03LFS0LFCT0FFC,P0FFCW03XFCW03FF8N03FFT03LFS0LFCT0FFC,P0FFCX0XFX03FF8N03FFT03LFS0LFCT0FFC,P0FFCX03VFCX03FF8N03FFT03LFS0LFCT0FFC,P0FFCY0VFY03FF8N03FFT03LFS0LFCT0FFC,P0FFCY01TFCY03FF8N03FFT03LFS0LFCT0FFC,P0FFCg07RFEg03FF8N03FFT03LFS0LFCT0FFC,P0FFCgG0RFgG03FF8N03FFT03LFS0LFCT0FFC,P0FFCgH0PF8gG03FF8N03FFT03LFS0LFCT0FFC,P0FFCgH01NF8gH03FF8N03FFT03LFS0LFCT0FFC,P0FFCgJ03JFEgJ03FF8N03FFT03LFS0LFCT0FFC,P0FFCgJ01JFCgJ03FF8N03FFT03LFS0LFCT0FFC,P0FFCgJ01JF8gJ03FF8N03FFT03LFS0LFCT0FFC,:::P0FFCgK0JF8gJ03FF8N03FFT03LFS0LFCT0FFC,::P0FFCgJ01JF8gJ03FF8N03FFT03LFS0LFCT0FFC,:::::::::::::::::::::::::::P0FFCgJ01JF8gJ03FF8N03FFhU0FFC,:::::P0FFCgK0JF8gJ03FF8N03FFhU0FFC,:P0FFCgJ01JFCgJ03FF8N03FFhU0FFC,P0FFCV03gFCV03FF8N03FFhU0FFC,P0FFCV03gFEV03FF8N03FFhU0FFC,P0FFCV03gFEV03FF8N03FFM01gYF8M0FFC,P0FFCV03gFEV03FF8N03FFM03gYFCM0FFC,:::::::::P0FFCV01gFCV03FF8N03FFM01gYF8M0FFC,P0FFChT03FF8N03FFhU0FFC,:::::::::::::::::::::::::::::::::::::P0FFEhT03FF8N03FF8hS01FFC,P0iF8N03hYFC,:::::P0iFO03hYFC,:P0iF8N03hYFC,P07hYFO01hYFC,,::::::::::::::::::::::::::::::::::^FS

^FO275,20
^GFA,1339,1339,13,,::::::::::::::::::::::::gG04,:g04C,g03E,g03F8,g01E,,::::::::::Y03E,Y07F,Y01F,g088,Y018,,::06,0E00C,:0E,1FE1C7E07C3E03E3F3E03E,1FF18FF0FE7F0FE7IF0FF,1C719E71E4E39E6F3F39E38,1833983381C39C0E1C39C38,38I38330183B81C1C39838,387338730183B81C183B83,38F338E701833018383183,1FE71FC7C1FF30183831FF,0FC61F8780FF70383070FF,M06,M0E,M0C,:,T0308,T03FBBE366,gG04,,:::::::::::::::::::::::::::::::^FS


^FO275,1980
^GFA,1339,1339,13,,::::::::::::::::::::::::gG04,:g04C,g03E,g03F8,g01E,,::::::::::Y03E,Y07F,Y01F,g088,Y018,,::06,0E00C,:0E,1FE1C7E07C3E03E3F3E03E,1FF18FF0FE7F0FE7IF0FF,1C719E71E4E39E6F3F39E38,1833983381C39C0E1C39C38,38I38330183B81C1C39838,387338730183B81C183B83,38F338E701833018383183,1FE71FC7C1FF30183831FF,0FC61F8780FF70383070FF,M06,M0E,M0C,:,T0308,T03FBBE366,gG04,,:::::::::::::::::::::::::::::::^FS

^FO25,120
^GB605,5,3^FS                        // Garis horizontal

^FO25,180
^GB605,5,3^FS                        // Garis horizontal kedua

^CF0,40
^FO180,140
^FDPACKING LABEL^FS                   // Judul besar

^FO25,600^GB250,250,3^FS               //Kotak Kode Petugas
^CF0,25
^FO40,610
^FDKode Petugas:^FS

^FO375,600^GB250,250,3^FS               //Massa Box
^CF0,25
^FO385,610
^FDMassa Box :^FS

^CF0,100
^FO390,435
^FD{no_box}^FS
^FO450,435
^FD/^FS
^FO480,435
^FD{total_box}^FS                          

// informasi tanggal kirim
^CF0,20
^FO450,200
^FD{tgl_kirim}^FS

// informasi tanggal kirim (segel)
^CF0,30
^FO200,1640
^FD{tgl_kirim}^FS


// Informasi pengirim (From)
^CF0,15
^FO25,190
^FDFrom:^FS
^FO25,205
^FDPT BIO FARMA^FS
^FO25,220
^FDJl. Pasteur No.28^FS
^FO25,235
^FDKota Bandung, Jawa Barat^FS

// Informasi penerima (To)
^CF0,15
^FO25,290
^FDTo:^FS
^FO25,305
^FD{nama_alamat}-{provinsi_alamat}^FS
^FO25,320
^FD{jalan_alamat}^FS
^FO25,335
^FD{pic_alamat}^FS
^FO25,350
^FD{notel_alamat}^FS

^FO25,370
^GB605,5,3^FS                       // Garis horizontal ketiga

^FO25,570
^GB605,5,3^FS                  // Garis horizontal terakhir

^FO0,1670
^GB660,5,10^FS                        // Garis horizontal ATAS SEGEL

^FO0,1620
^GB660,5,10^FS                        // Garis horizontal BAWAH SEGEL

^CF0,50
^FO115,1030
^FDJANGAN DI BANTING^FS
^FO25,1000^GB600,100,6^FS
^FO140,1150
^FDJANGAN DI BALIK^FS
^FO25,1120^GB600,100,6^FS
^FO120,910
^FDJANGAN DI LEMPAR^FS
^FO25,880^GB600,100,6^FS
^FO120,1290
^FDHANDLE WITH CARE^FS

^FO25,1700^BXN,6,200
^FDhttps://shorturl.at/Oc5HP^FS
^CF0,40
^FO190,1730
^FDSCAN UNTUK MELIHAT^FS
^FO190,1770
^FDPANDUAN UNBOXING^FS

^CF0,27
^FO25,1870
^FD!! PASTIKAN SEGEL TIDAK RUSAK ^FS
^FO25,1900
^FD!! SERTAKAN VIDEO UNBOXING SAAT MEMBUKA SEGEL^FS
^FO25,1930
^FD!! SERTAKAN VIDEO ISI DALAM BOX^FS

^FO25,392^BXN,4,200
^FD{produk}^FS
^XZ

"""
zpl_data = ""
for _, row in data.iterrows():
    zpl_data += zpl_code.format(
        tgl_kirim=row['TANGGAL'],
        nama_alamat=row['db_ALAMAT.NAMA'],
        jalan_alamat=row['db_ALAMAT.JALAN'],
        provinsi_alamat=row['db_ALAMAT.PROVINSI'],
        pic_alamat=row['db_ALAMAT.PIC'],
        notel_alamat=row['db_ALAMAT.NO-TEL'],
        produk=row['PRODUK'],
        no_box=row['NO_BOX'],
        total_box=row['TOTAL_BOX']
    )
url = 'http://api.labelary.com/v1/printers/8dpmm/labels/1.1x3.5/0/'
files = {'file' : zpl_data}
headers = {'Accept' : 'application/pdf'} # omit this line to get PNG images back
response = requests.post(url, headers = headers, files = files, stream = True)

if response.status_code == 200:
    response.raw.decode_content = True
    output_pdf_path = r'C:\Users\rahmat.wahyu\Desktop\project excel\label.pdf'
    if os.path.exists(output_pdf_path):
        os.remove(output_pdf_path)
    with open(output_pdf_path, 'wb') as out_file: # change file name for PNG images
        shutil.copyfileobj(response.raw, out_file)
else:
    print('Error: ' + response.text)
